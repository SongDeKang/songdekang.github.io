<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, shrink-to-fit=no">
    <meta name="referrer" content="origin">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <title>REACT 井字棋</title>

    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/font/LongCang.css">
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/font/Monda.css">
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/font/NotoSansSC.css">
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/font/Playball.css">
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/font/PTMono.css">
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/font/RobotoSlab.css">
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/font/Rosario.css">
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/font/UbuntuMono.css">

    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/css/post.css">
    
        <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/css/normal.css">
    

    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/js/jquery-3.4.1.min.js"></script>

    <style>
        html,body{
            text-indent: 2em;
            font-family: 宋体;
            line-height: 1.8em;
            background: rgba(255, 255, 255, 0.3);
            /* box-shadow: 0 2px 6px rgb(0 0 0 / 65%) */
        }
        .article-prev-next{
            display: flex;
            justify-content: space-between;
        }
        h1, h2, h3, h4, h5, h6 {
            padding: 0;
            text-align:center
        }
        .article-body p {
            text-indent:2em;
            font-size: 16px;
        }
        /* 
            TODO: 试了下，把短少的正文，使用flex布局，居中。看着还不错的
        */
    </style>

<meta name="generator" content="Hexo 5.3.0"></head>
<body>
    <a id="cover"></a>
    <div id="header">
    <div class="header">
        <div class="vertical">
            <div class="inner">
                <h1 class="header-subtitle">REACT 井字棋</h1>
                <div class="header-subinfo">
                    <p class="article-info-text">
                        <span>
                            <i class="iconfont icon-time"></i> 发表时间：2021-07-02
                        </span>
                        
                            <span id="/2021/07/02/REACT-井字棋/" class="leancloud_visitors" data-flag-title="REACT 井字棋">
                                <i class="iconfont icon-browse"></i> 阅读：<sapn class="leancloud-visitors-count"></span>
                            </span>
                        
                        <span>
                            <i class="iconfont icon-interactive"></i> 评论：<span class="valine-comment-count" data-xid="/2021/07/02/REACT-井字棋/"></span>
                        </span>  
                    </p>                 
                </div>
            </div>
        </div>
        <canvas id="articleHeaderCanvas"></canvas>
    </div>
</div>
    <div id="container" style="max-width: 740px !important">
    <div id="content">
        <div id="article">
  <div class="toc"></div>
  <div class="article-body">
    <ul>
<li><a href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87">环境准备</a><ul>
<li><a href="#%E6%96%B9%E5%BC%8F%E4%B8%80%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%811">方式一：在浏览器中编写代码<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup></a></li>
<li><a href="#%E6%96%B9%E5%BC%8F%E4%BA%8C%E6%90%AD%E5%BB%BA%E6%9C%AC%E5%9C%B0%E7%8E%AF%E5%A2%83">方式二：搭建本地环境</a></li>
</ul>
</li>
<li><a href="#%E6%A6%82%E8%A7%88">概览</a><ul>
<li><a href="#react-%E6%98%AF%E4%BB%80%E4%B9%88">React 是什么</a></li>
<li><a href="#%E9%98%85%E8%AF%BB%E5%88%9D%E5%A7%8B%E4%BB%A3%E7%A0%81">阅读初始代码</a></li>
<li><a href="#%E9%80%9A%E8%BF%87-props-%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE">通过 Props 传递数据</a></li>
<li><a href="#%E7%BB%99%E7%BB%84%E4%BB%B6%E6%B7%BB%E5%8A%A0%E4%BA%A4%E4%BA%92%E5%8A%9F%E8%83%BD">给组件添加交互功能</a></li>
<li><a href="#%E5%BC%80%E5%8F%91%E8%80%85%E5%B7%A5%E5%85%B7">开发者工具</a></li>
<li><a href="#%E6%B8%B8%E6%88%8F%E5%AE%8C%E5%96%84">游戏完善</a></li>
<li><a href="#%E7%8A%B6%E6%80%81%E6%8F%90%E5%8D%87">状态提升</a></li>
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E5%8F%AF%E5%8F%98%E6%80%A7%E5%9C%A8-react-%E4%B8%AD%E9%9D%9E%E5%B8%B8%E9%87%8D%E8%A6%81">为什么不可变性在 React 中非常重要</a><ul>
<li><a href="#%E7%AE%80%E5%8C%96%E5%A4%8D%E6%9D%82%E7%9A%84%E5%8A%9F%E8%83%BD">简化复杂的功能</a></li>
<li><a href="#%E8%B7%9F%E8%B8%AA%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8F%98%E5%8C%96">跟踪数据的变化</a></li>
<li><a href="#%E7%A1%AE%E5%AE%9A%E5%9C%A8-react-%E4%B8%AD%E4%BD%95%E6%97%B6%E9%87%8D%E6%96%B0%E6%B8%B2%E6%9F%93">确定在 React 中何时重新渲染</a></li>
<li><a href="#%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6">函数组件</a></li>
</ul>
</li>
<li><a href="#%E8%BD%AE%E6%B5%81%E8%90%BD%E5%AD%90">轮流落子</a></li>
<li><a href="#%E5%88%A4%E6%96%AD%E5%87%BA%E8%83%9C%E8%80%85">判断出胜者</a></li>
<li><a href="#%E6%97%B6%E9%97%B4%E6%97%85%E8%A1%8C">时间旅行</a><ul>
<li><a href="#%E4%BF%9D%E5%AD%98%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95">保存历史记录</a></li>
<li><a href="#%E5%86%8D%E6%AC%A1%E6%8F%90%E5%8D%87%E7%8A%B6%E6%80%81">再次提升状态</a></li>
<li><a href="#%E9%80%89%E6%8B%A9%E4%B8%80%E4%B8%AA-key">选择一个 key</a></li>
<li><a href="#%E5%AE%9E%E7%8E%B0%E6%97%B6%E9%97%B4%E6%97%85%E8%A1%8C">实现时间旅行</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%80%BB%E7%BB%93">总结</a><!-- # 井字棋 -->

</li>
</ul>
<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><p>完成这篇教程有两种方式：</p>
<ol>
<li>可以直接在浏览器中编写代码</li>
<li>也可以在你电脑上搭建本地开发环境</li>
</ol>
<h3 id="方式一：在浏览器中编写代码1"><a href="#方式一：在浏览器中编写代码1" class="headerlink" title="方式一：在浏览器中编写代码1"></a>方式一：在浏览器中编写代码<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup></h3><h3 id="方式二：搭建本地环境"><a href="#方式二：搭建本地环境" class="headerlink" title="方式二：搭建本地环境"></a>方式二：搭建本地环境</h3><p>这是完全可选的，本教程不强制要求。</p>
<p>可选项：使用你喜欢的文本编辑器进行本地开发的步骤：</p>
<p>虽然在本地搭建环境要费一些时间，但是你可以选择自己喜欢的编辑器来完成开发。以下是具体步骤：</p>
<ol>
<li><p>确保你安装了较新版本的 <code>Nodejs</code></p>
</li>
<li><p>按照<code>Create React App</code><a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/create-a-new-react-app.html#create-react-app">安装指南</a>创建一个新的项目</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npx create-react-app my-app</span><br><span class="line"><span class="comment">// 由此可见 得使用 npx 命令</span></span><br><span class="line"><span class="comment">// 项目名称可以有 连字符 但是不能大写</span></span><br></pre></td></tr></table></figure></li>
<li><p>删除掉新项目<code>src/</code>文件夹下的所有文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line">不要删除整个 src 文件夹</span><br><span class="line">删除里面的源文件</span><br><span class="line">我们会在接下来的步骤中使用示例代码替换原文件</span><br><span class="line"></span><br><span class="line">// 删除命令：</span><br><span class="line"><span class="built_in">cd</span> hello-vue3</span><br><span class="line"><span class="built_in">cd</span> src</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果你使用 Mac 或 Linux：</span></span><br><span class="line">rm -f *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果你使用 Windows：</span></span><br><span class="line">del *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 然后回到项目文件夹</span></span><br><span class="line"><span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure></li>
<li><p>在<code>src/</code>文件夹下创建一个名为<code>index.css</code>的文件，并拷贝这<a target="_blank" rel="noopener" href="https://codepen.io/gaearon/pen/oWWQNa?editors=0100">些 CSS 代码</a>。</p>
</li>
<li><p>在<code>src/</code>文件夹下创建一个名为<code>index.js</code>的文件，并拷贝<a target="_blank" rel="noopener" href="https://codepen.io/gaearon/pen/oWWQNa?editors=0010">这些 JS 代码</a></p>
</li>
<li><p>拷贝以下三行代码到<code>src/</code>文件夹下的<code>index.js</code>文件的顶部：</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./index.css&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>现在，在项目文件夹下执行<code>npm start</code>命令，然后在浏览器访问<code>http://localhost:3000</code>。这样你就可以在浏览器中看见一个空的井字棋的棋盘了。</p>
<h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><p>你已经准备好了，让我们先大致了解一些 React 吧！</p>
<h3 id="React-是什么"><a href="#React-是什么" class="headerlink" title="React 是什么"></a>React 是什么</h3><p>React 是一个声明式，高效且灵活的用于构建用户界面的 JavaScript 库。使用 React 将一些简短、独立的代码片段组合成复杂的 UI 界面，这些代码被称作组件。</p>
<p>React 中拥有多种不同类型的组件，我们先从<code>React.Component</code>的子类开始介绍：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShoppingList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;shopping-list&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Shopping List for &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">li</span>&gt;</span> Instagram <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">li</span>&gt;</span> WhatsApp <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">li</span>&gt;</span> Oculus <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 用法示例： &lt;ShoppingList name=&quot;mark&quot;&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们马上会谈论这些又奇怪、又像 XML 的标签。我们通过使用组件来告诉 React 我们希望在屏幕上看到什么。当数据发生改变时，React 会高效地更新并重新渲染我们的组件。</p>
<p>其中，ShoppingList 是一个 React 组件累，或者说是一个 React 组件类型。一个组件接收一些参数，我们把这些参数叫做 props （“props”是“property”简写），然后通过 render 方法返回需要展示在屏幕上的视图层次结构。</p>
<p>render 方法的返回值 <em>描述了</em> 你希望在屏幕上看到的内容。 React 根据描述，把结果展示出来。更具体地来说，render 返回了一个 React 元素，这是一种对渲染内容的 <strong>轻量级</strong> 描述。大多数的 React 开发者使用一种名为 “JSX” 的特殊语法，JSX 可以让你更轻松的书写这些结构。语法<code>&lt;div/&gt;</code>会被编译成 <code>React.createElement(&#39;div&#39;)</code>。上述的代码等同于：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> React.createElement(<span class="string">&#x27;div&#x27;</span>,&#123;<span class="attr">className</span>:<span class="string">&#x27;shopping-list&#x27;</span>&#125;,</span><br><span class="line">   React.createElement(<span class="string">&#x27;h1&#x27;</span>,<span class="comment">/* ... h1 children ... */</span>),</span><br><span class="line">   React.createElement(<span class="string">&#x27;ul&#x27;</span>,<span class="comment">/* ... ul children ... */</span>)</span><br><span class="line">),</span><br></pre></td></tr></table></figure>
<p>如果你对这个比较感兴趣，可以查阅 API 文档了解有关<code>createElemnt()</code>更详细的用法。但是接下来的教程中，我们并不会直接使用这个方法，而是继续使用 <strong>JSX</strong>。</p>
<p>在 JSX 中你可以任意使用 <strong>JavaScript 表达式</strong>，只需要用一个大括号括起来。</p>
<p>每一个 React 元素 事实上都是一个 _JavaScript 对象_，你可以在你的程序里把它保存在变量中或者作为参数传递。</p>
<p>前文中的 <code>ShoppingList</code> 组件只会渲染一些内置的 DOM 组件（是说标签元素吧）,如<code>&lt;div /&gt;、&lt;li /&gt;</code>等。但是你也可以组合和渲染自定义的 React 组件。例如，你可以通过 <code>&lt;ShoppingList /&gt;</code>来表示整个购物清单组件。每个组件都是封装好的，并且可以单独运行，这样你就可以通过简单的组件来构建复杂的 UI 界面。</p>
<h3 id="阅读初始代码"><a href="#阅读初始代码" class="headerlink" title="阅读初始代码"></a>阅读初始代码</h3><p>如果你要在 <strong>浏览器</strong> 中学习该教程，在新标签页中打开初始代码。<br>如果你要在本地环境中学已开发该教程的内容，就在你的工程文件夹下打开 <code>src/index.js</code>（你已经在前面的环境准备中创建过这个文件了） <!-- Yes I remember --></p>
<p>这些初始代码，是我们要开发小游戏的基础代码。我们已经提供了 CSS 样式，这样你只需要关注使用 React 来开发这个井字棋了。</p>
<p>通过阅读代码，你开一看到我们又三个 React 组件：</p>
<ul>
<li>Square</li>
<li>Board</li>
<li>Game</li>
</ul>
<p>Square 组件渲染了含有默认值的一个棋盘，我们一会会修改这些默认值。到目前为止还没有可以交互的组件。</p>
<h3 id="通过-Props-传递数据"><a href="#通过-Props-传递数据" class="headerlink" title="通过 Props 传递数据"></a>通过 Props 传递数据</h3><p>让我们试试水，尝试将数据从 Board 组件传递到 Square 组件中。</p>
<p>我们强烈建议你手动编写本教程中的代码，不要使用 <em>复制/粘贴</em> 。这将加深你对 React 的记忆和理解。</p>
<p>在 Board 组件中的 <code>renderSquare</code> 方法中，我们将代码改写成下面这样，<strong>传递一个名为<code>value</code>的<code>prop</code>到<code>Square</code>组件当中</strong>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">renderSquare</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Square</span> <span class="attr">value</span>=<span class="string">&#123;i&#125;</span> /&gt;</span></span>;</span><br><span class="line">    <span class="comment">// 封装成 函数 应该就是方便【传参】调用</span></span><br><span class="line">    <span class="comment">// 也简化了书写，要不然使用到的每个【Square】组件都要写【value】属性了</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改 Square 组建中的 render 方法，把 <code>l&#123;/* TODO */&#125;</code>，以显示上文传入的值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;Square&quot;</span>&gt;</span>&#123;this.props.value&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>恭喜你！你刚刚成功地把一个 prop 从父组件 Board <strong>传递</strong> 给了子组件 Square 。在 React 应用中，数据通过 props 的传递，从父组件流向子组件。</p>
<h3 id="给组件添加交互功能"><a href="#给组件添加交互功能" class="headerlink" title="给组件添加交互功能"></a>给组件添加交互功能</h3><p>接下来我们试着让期盼的每一个格子在点击之后能落下一颗 “X” ,作为棋子。首先，我们把 Square 组件中的 render() 方法的返回值中 button 标签修改为如下内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;Square&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> alert(&quot;click&quot;)&#125;&gt;</span></span><br><span class="line"><span class="xml">        &#123;this.porps.value&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果此刻点击某个格子，浏览器就会弹出提示框。</p>
<p><code>注意: 为了减少代码量，同时避免*[this]造成的困扰，我们在这里使用 [箭头函数] 来进行事件处理。</code><br><code>注意：此处使用了*onClick=&#123;()=&gt;alert(&quot;click&quot;)&#125;*的方式向*onClick*这个*prop*传入一个函数。 React 将在单机时调用此函数。但很多人经常忘记编写 ()=&gt; ,而写成 onClick = &#123;alert(&quot;click&quot;)&#125;,这种常见的错误会导致每次这个组件渲染的时候都会出发弹出框</code></p>
<p>接下来，我们希望 Square 可以 “记住” 他被点击过，然后用 “X” 来填充对应的方格。我们用 state 来实现所谓的 “记忆” 功能。</p>
<p>可以通过在 React 组建的构造函数中设置 this.state 来初始化 state。 this.state 应该被是为一个组建的私有属性。我们在<code>this.state</code>中储存当前每个方格（Square）的值，并且在每次方格被点击时改变这个值。</p>
<p>首先，我们向这个 class 中添加一个构造函数，用来初始化 state：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">   <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span>&#123;</span><br><span class="line">      <span class="built_in">super</span>(props)</span><br><span class="line"></span><br><span class="line">      <span class="built_in">this</span>.state = &#123;</span><br><span class="line">         <span class="attr">value</span>:<span class="literal">null</span>,</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">         <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;square&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> alert(&#x27;click&#x27;)&#125;&gt;</span></span><br><span class="line"><span class="xml">            &#123;this.props.value&#125;</span></span><br><span class="line"><span class="xml">         <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">         );</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>注意：在JavaScript中，每次你定义其子类的构造函数时，都需要调用 super 方法。因此，在所有含有构造函数的 React 组件中，**构造函数必须以super(props)开头**。</code><!--这件事我一直想知道原因--></p>
<p>现在，我们来修改一下 Square 组件的 render 方法，这样，每当方格被点击的时候，就可以显示当前 state 的值了：</p>
<ul>
<li>在<code>button</code>标签中，把<code>this.props.value</code>替换为 <code>this.state.value</code></li>
<li>将<code>onClick=&#123;...&#125;</code>事件监听函数替换为<code>onClick=&#123;()=&gt;this.setState(&#123;value:&quot;X&quot;&#125;)&#125;</code>。</li>
<li>为了更好的可读性，将<code>className</code>和<code>onClick</code>的 prop 分两行书写。</li>
</ul>
<p>修改之后，Square 组件中的 render 方法的返回值中的 button 标签变成了下面这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      <span class="attr">value</span>: <span class="literal">null</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;Square&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> this.setState(&#123; value: &quot;X&quot; &#125;)&#125;&gt;</span></span><br><span class="line"><span class="xml">        &#123;this.state.value&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 Square 组件 render 方法中 onClick 事件监听函数中调用 this.setState ,我们就可以在每次 <code>&lt;button&gt;</code>被点击的时候通知 React 去重新渲染 Square 组件。组件更新之后，Square 组件的 this.state.value 的值会变为 “X”，因此，我们在游戏棋盘上就能看见 X 了。点击任意一个方格， X 就会出现。</p>
<p>每次在组件中调用 <code>setState</code> 时，React 都会自动更新其子组件。</p>
<h3 id="开发者工具"><a href="#开发者工具" class="headerlink" title="开发者工具"></a>开发者工具</h3><p>在 Chrome 或者 Firefox 中安装扩展 <code>React Devtools</code>可以让你在浏览器开发工具中查看 React 组件树。</p>
<p>你还可以在 React Devtools 中检查 React 组件的 state 和 props 。</p>
<p>安装 React Devtools 之后，右键点击页面的任何一个元素，然后选择<strong>查看</strong>，这样就能打开浏览器的开发者工具了，并且工具栏最后会多展示一个 React 的选项卡（包含 <code>components</code>和<code>profiler</code>）。你可以使用 <em>components</em> 来检查组件树。</p>
<h3 id="游戏完善"><a href="#游戏完善" class="headerlink" title="游戏完善"></a>游戏完善</h3><p>我们现在已经编写好了，游戏中最基础的可以落子的棋盘。为了开发一个完整的游戏，<strong>我们还需要交替在棋盘上放置“X”和“O”，并且判断出胜者</strong></p>
<h3 id="状态提升"><a href="#状态提升" class="headerlink" title="状态提升"></a>状态提升</h3><p>当前，每个 Square 组件都维护了游戏的状态。我们可以把所有 9 个 Square 放在一个地方，这样我们就可以判断出胜者了。</p>
<p>你可能回想，我们也可以在棋盘 Board 组件中收集每个格子 Square 组件中的 state。虽然技术上来讲是可以实现的，但是代码如此编写会让人很难理解，并且我们以后想要维护重构时也会非常困难。</p>
<p>所以，最好的解决方式是直接将所有的 <strong>state</strong> 状态数据存储在 Board 父组件当中。之后 Board 组件可以将这些数据通过 props 传递给各个 Square 子组件，正如上文：我们把数字传递给每个 Square 一样。</p>
<p><strong><code>当你需要同时获取多个子组件的数据，或者两个组件之间需要相互通讯的情况下，需要把自组建的 state 提升至其共同的父组件当中保存。之后父组件可以通过 props 将状态数据传递到子组件当中。这样应用当中所有的组件状态数据就能够方便的同步共享了</code></strong></p>
<p>像这种将组件 state 提升到父组件的情形在重构 React 组件时经常会遇到————借此我们来实践一下。</p>
<p>为 Board 组件添加构造函数，将 Board 组件的初始状态设置为长度为 9 的空值数组：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 唉！。。。</span></span><br><span class="line"><span class="comment">// 到这我可以理解：分别获取每个子组件的状态就算可实现也是不切实际。所以通过父组件统一控制状态并分发给子组件确实是很好的选择。</span></span><br><span class="line"><span class="comment">// 但是我是真的没想到父组件要，设定什么样的状态数据结构，也完全想不到怎么去实现</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">   <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span>&#123;</span><br><span class="line">      <span class="built_in">super</span>(props)</span><br><span class="line">      <span class="built_in">this</span>.state=&#123;</span><br><span class="line">         squares=<span class="built_in">Array</span>(<span class="number">9</span>).fill(<span class="literal">null</span>)</span><br><span class="line">         <span class="comment">// 高级，这数组操作我是没掌握</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="title">renderSquare</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Square</span> <span class="attr">value</span>=<span class="string">&#123;i&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">   &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure>
<p>当我们填充棋盘后，<code>this.state.squares</code>数组的值可能如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;O&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;X&quot;</span>, <span class="string">&quot;X&quot;</span>, <span class="string">&quot;X&quot;</span>, <span class="string">&quot;O&quot;</span>, <span class="string">&quot;O&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>];</span><br><span class="line"><span class="comment">// 本来还在想数组怎么会呈现这样的结构呢</span></span><br><span class="line"><span class="comment">// 原来就是三个一换行啊</span></span><br></pre></td></tr></table></figure>
<p>开始时，我们依次把 0 到 8 的值通过 prop 从 Board 向下传递，从而让他们显示出来。上一步与此不同，我们根据 Square 自己内部的 state， 使用了 “X” 来代替之前的数字。因此，Square 忽略了从 Board 传递给它的那个 <code>value</code> prop。</p>
<p>让我们再一次使用 prop 的传递机制。我们通过修改 Board 来指示每一个 Square 的当前值（“X”，“O”,或者 null）。我们在 Board 的构造函数中已经定义好了 squares 数组，这样，我们就可以通过修改 Board 的 renderSquare 方法来读取这些值了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">renderSquare</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Square</span> <span class="attr">value</span>=<span class="string">&#123;this.state.squares[i]&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">   // 我是真没想到，之前每个穿的数组干什么用，做个标识看看么</span></span><br><span class="line"><span class="xml">   // 没想到能直接拿到这当 数组 索引 绝了</span></span><br><span class="line"><span class="xml">   // 还有就是，本来点击显示 X ，之后不是该讲显示 O 了么？</span></span><br><span class="line"><span class="xml">   // 怎么就岔开将状态提升了，原来之前显示 X 只是个示例</span></span><br><span class="line"><span class="xml">   // 真实优化修改还没讲到啊</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure>
<p>这样，每个 Square 就都能结束到一个 <code>value</code> prop 了，这个 prop 的值可以是 “X”、”O”或 null（null 代表空方格）。</p>
<p>接下来，我们要修改一下 Square 的点击事件监听函数。Board 组件当前维护了那些已经被填充了的方格。<strong>我们需要想办法让 Square 去更新 Board 的 state</strong>。由于 state 对于每个组件来说是私有的，因此我们不能直接通过 Square 来更新 Board 的 state 。</p>
<p>相反，<strong>从 Board 组件向 Square 组件传递一个函数，当 Square 被点击的时候，这个函数就会被调用。</strong>接着，我们将 Board 组件的 renderSquare 方法改写为如下效果：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">renderSquare</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">   <span class="keyword">return</span>(</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">Square</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">         <span class="attr">value</span>=<span class="string">&#123;this.state.squares[i]&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">         <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>this.handleClick(i)&#125;</span></span><br><span class="line"><span class="xml">      /&gt;</span></span><br><span class="line">   )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><code>注意：为了提到可读性，我们把返回的 React 元素拆分成了多行。同时在最外层加了小括号，这样 JavaScript 解析的时候就不会咋 return 的后面自动插入一个分号，从而破坏代码结构了</code></strong></p>
<p>现在我们从 Board 组件向 Square 组件中传递了两个 porps 参数 value 和 onClick 。onClick prop是一个 Square 组件点击事件监听函数。接下来，我们需要修改 Square 的代码：</p>
<ul>
<li><p>将 Square 组件的 render 方法中的 this.state.value 替换为 this.props.value</p>
</li>
<li><p>将 Square 组件的 render 方法中的 this.setState() 替换为 <code>this.props.onClick()</code></p>
<!-- 我真是没想到 这个属性还真的要在子组件里面重新调用一下 我是真懵 -->
<!-- 我还以为子组件里面点击事件都不需要了 -->
<!-- 还是 too young 啊 --></li>
<li><p>删除 Square 组件中的构造函数 constructor ，该组件不需要再保存游戏的 state</p>
</li>
</ul>
<p>进行上述修改之后，代码会变成下面这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span> </span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">className</span>=<span class="string">&quot;Square&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>this.props.onClick()&#125;</span></span><br><span class="line"><span class="xml">      &gt;</span></span><br><span class="line"><span class="xml">        &#123;this.props.value&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每一个 Square 被点击时，Board 提供的 onClick 函数就会触发。我们回顾一下这是怎么实现的：</p>
<ol>
<li>向 DOM 元素 button <strong>添加 onClick prop ，让 React 开启对点击事件的监听。</strong></li>
<li>当 button 被点击时， React 会调用 Square 组件的 render() 方法中 onClick 事件处理函数</li>
<li>事件处理函数触发了传入其中的 <code>this.props.onClick()</code> 方法。这个方法是由 Board 组件传递给 Square 的。</li>
<li>由于 Board 把 <code>onClick=&#123;()=&gt;this.handleClick(i)&#125;</code> 传递给了 Square ，所以当 Square 中的事件处理函数触发时，其实就是出发的 Board 当中的 this.handleClick(i) 方法。</li>
<li>我们还未定义 handleClick 方法，所以代码还不能正常工作。如果此时点击 Square ，你会在屏幕上看到红色的错误提示，提示内容为： “ this.handleClick is not a function “。</li>
</ol>
<p><strong><code>注意：因为 DOM 元素 &lt;button/&gt; 是一个内置组件[ 哦哦懂了，我一直以为该说时html元素的，原来这是指 react 内置组件啊 ]</code></strong></p>
<p>这时候我们点击 Square 的时候,浏览器汇报从,因为我们还没有定义 handleClick 方法。我们现在来向 Board 里添加 handleClick 方法：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">super</span>(props)</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      <span class="attr">squares</span>: <span class="built_in">Array</span>(<span class="number">9</span>).fill(<span class="literal">null</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="title">handleClick</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> squares = <span class="built_in">this</span>.state.squares.slice();</span><br><span class="line">    <span class="comment">// slice 是生成一个深拷贝的新数组么？</span></span><br><span class="line">    squares[i] = <span class="string">&quot;X&quot;</span></span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      <span class="attr">squares</span>:squares</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 还有一点想到就是，这个存状态的数据，竟然不直接 map 生成 jsx ，而是一个个写出来，调用函数，传入 1~9 数字作为索引。</span></span><br><span class="line">    <span class="comment">// 是让初学者更容易看懂么？</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">renderSquare</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">Square</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">       <span class="attr">value</span> = <span class="string">&#123;this.state.squares[i]&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">       <span class="attr">onClick</span> = <span class="string">&#123;()</span>=&gt;</span>this.handleClick(i)&#125;</span></span><br><span class="line"><span class="xml">       // 刚才还纳闷，方法为什么都不用箭头函数</span></span><br><span class="line"><span class="xml">       // 想到可能是：使用箭头函数 或者 bind this 都是解决 this 指向的，方法里面没用到 this 自然不用</span></span><br><span class="line"><span class="xml">      /&gt;</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> status = <span class="string">&quot;Next player: X&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;status&quot;</span>&gt;</span>&#123; status &#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>       </span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;board_row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">         &#123;/* class 我还是用下划线吧，毕竟不会像连字符一样当成两个独立的单词 */&#125;</span></span><br><span class="line"><span class="xml">         &#123;this.renderSquare(1)&#125;</span></span><br><span class="line"><span class="xml">         &#123;this.renderSquare(2)&#125;</span></span><br><span class="line"><span class="xml">         &#123;this.renderSquare(3)&#125;</span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;board_row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">         &#123;this.renderSquare(4)&#125;</span></span><br><span class="line"><span class="xml">         &#123;this.renderSquare(5)&#125;</span></span><br><span class="line"><span class="xml">         &#123;this.renderSquare(6)&#125;</span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;board_row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">         &#123;this.renderSquare(7)&#125;</span></span><br><span class="line"><span class="xml">         &#123;this.renderSquare(8)&#125;</span></span><br><span class="line"><span class="xml">         &#123;this.renderSquare(9)&#125;</span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在，我们可以通过点击 Square 来填充那些方格，效果与之前相同。但是，当前 state 没有保存再单个的 Square 组件中，而是保存在了 Board 组件中。每当 Board 的 state 发生变化的时候，这些 Square 组件都会重新渲染一次。把所有的 Square 的 state 保存再 Board 组件中可以让我们在将来判断出游戏的胜者。</p>
<p>因为 Square 组件不再持有 state，因此每次他们被点击的时候，Square 组件就会从 Board 组件中接受值，并且通知 Board 组件。在 React 术语中，我们把目前的 Square 组件称作“受控组件”。在这种情况下，Board 组件完全控制了 Square 组件。</p>
<p>注意，我们调用了 <code>.slice()</code> 方法创建了 <code>squares</code> 数组的一个副本，而不是直接在现有的数组上进行修改。在协议姐，我们会介绍为什么我们需要创建 <code>square</code>数组的副本。</p>
<h3 id="为什么不可变性在-React-中非常重要"><a href="#为什么不可变性在-React-中非常重要" class="headerlink" title="为什么不可变性在 React 中非常重要"></a>为什么不可变性在 React 中非常重要</h3><p>在上一节内容当中，我们建议使用 <code>.slice()</code> 方法对数组进行拷贝，而非直接修改现有的数组。<br>接下来我们学习 <strong>不可变性</strong> 以及 <strong>不可变性的重要性</strong>。</p>
<p>一般来说，有两种改变数据的方式。第一种方式是直接 <em>修改</em> 变量的值，第二种方式是 <em>使用新的一份数据替换旧数据</em></p>
<p><strong>直接修改数据：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> player = &#123;<span class="attr">score</span>:<span class="number">1</span>,<span class="attr">name</span>:<span class="string">&#x27;jeff&#x27;</span>&#125;;</span><br><span class="line">play.score = <span class="number">2</span>;</span><br><span class="line"><span class="comment">// player 修改后的值为 &#123;score:2,name:&#x27;jeff&#x27;&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>新数据替换旧数据：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> player = &#123;<span class="attr">score</span>:<span class="number">1</span>,<span class="attr">name</span>:<span class="string">&#x27;jeff&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">var</span> newPlayer = <span class="built_in">Object</span>.assign(&#123;&#125;,player,&#123;<span class="attr">score</span>:<span class="number">2</span>&#125;);</span><br><span class="line"><span class="comment">// player 的值没有改变， newPlayer 的值为 &#123;score:2,name:&#x27;jeff&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用对象展开语法，可以写成：</span></span><br><span class="line"><span class="keyword">var</span> newPlayer= &#123;...player,<span class="attr">score</span>:<span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure>
<p>不直接修改（或改变底层数据）这种方式和前一种方式的结果是一样的，这种方式有一些几点好处：</p>
<h4 id="简化复杂的功能"><a href="#简化复杂的功能" class="headerlink" title="简化复杂的功能"></a>简化复杂的功能</h4><p>不可变性使得复杂的特性更容易实现。在后面的章节里，我们会实现一种叫做“时间旅行”的功能。“时间旅行”可以使我们回顾井字棋的历史步骤，并且可以“跳回”之前的步骤。这个功能并不是只有游戏才会用到————撤销和恢复功能在开发中是一个很常见的需求。<!--确实，我有一个取消的功能就没有实现-->不直接修改可以让我们追溯并复用游戏的历史纪录。</p>
<h4 id="跟踪数据的变化"><a href="#跟踪数据的变化" class="headerlink" title="跟踪数据的变化"></a>跟踪数据的变化</h4><p>如果直接修改数据，那么就很难跟踪到数据的改变。跟踪数据的改变需要可变对象可以与改变之前的版本进行对比，这样整个对象树都需要被遍历一次。</p>
<p>跟踪不可变数据的变化相对来说就容易多了。如果发现对象变成了一个新对象，那么我们就可以说对象发生改变了。</p>
<h4 id="确定在-React-中何时重新渲染"><a href="#确定在-React-中何时重新渲染" class="headerlink" title="确定在 React 中何时重新渲染"></a>确定在 React 中何时重新渲染</h4><p>不可变性最主要的优势在于它可以帮助我们在 React 中创建 <em>pure components</em> 。我们可以很轻松的确定不可变数据是否发生了改变，从而确定合适对组件进行重新渲染。</p>
<p>查阅性能优化章节，以了解更多有关 should ComponentUpdate() 函数及如何构建 pure components 的内容。</p>
<h4 id="函数组件"><a href="#函数组件" class="headerlink" title="函数组件"></a>函数组件</h4><p>接下来我们把 Square 组件重写为一个 <strong>函数组件</strong>。</p>
<p>如果你想写的组件只包含一个 render 方法，并且不包含 state ，那么使用 <strong>函数组件</strong> 就会更简单。 我们不需要定义一个 继承于 React.Component 的类，我们可以定义一个函数，这个函数接受 <em>props</em> 作为参数，然后返回需要渲染的元素。函数组件写起来不像 class 组件那么繁琐，很多组件都可以使用函数组件来写。</p>
<p>把 Square 类替换成下面的函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Square</span>(<span class="params">props</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span> = <span class="string">&quot;square&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;props.onClick&#125;</span>&gt;</span> &#123;props.value&#125; <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们把两个 this.props 都换成了 props 。</p>
<p><strong><code>注意：当我们把 Square 修改成函数组件时，我们同时也把 onClick=&#123;()=&gt;this.props.onClick()&#125; 改成了更短的 onClick=&#123;props.onClick&#125;</code>(注意：两侧都没括号)</strong></p>
<!-- 光让我注意，也不讲讲为啥 -->

<h3 id="轮流落子"><a href="#轮流落子" class="headerlink" title="轮流落子"></a>轮流落子</h3><p>现在井字棋还有一个明显的缺陷有待完善：目前还不能在棋盘上标记 “O”。<br>我们将 “X” 默认设置为先手棋。你可以通过修改 Board 组件构造函数中的初始 state 来设置默认的第一步棋子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">super</span>(props)</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      <span class="attr">square</span>:<span class="built_in">Array</span>(<span class="number">9</span>).fill(<span class="literal">null</span>),</span><br><span class="line">      <span class="attr">xIsNext</span>:<span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 我还在想，不是说设置默认先手棋么?为啥不直接整个 first: &#x27;X&#x27;,</span></span><br><span class="line">      <span class="comment">// 就是没想到这个可以直接判断每一步该落什么子，X 落过子之后，把 xIsNext 设置为 false 就能直接落 &#x27;O&#x27; 子了</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>棋子每移动一步，xIsNext（布尔值）都会反转，该值将确定下一步轮到哪个玩家，并且游戏的状态会被保存下来。我们将通过修改 Board 组件的函数 handleClick 函数来反转 xIsNext 的值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">handleClick</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> square = <span class="built_in">this</span>.state.squares.clice();</span><br><span class="line">  square[i] = <span class="built_in">this</span>.state.xIsNext ? <span class="string">&quot;X&quot;</span> : <span class="string">&quot;O&quot;</span>;</span><br><span class="line">  <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">    <span class="attr">squares</span>:square,</span><br><span class="line">    <span class="attr">xIsNext</span>:!<span class="built_in">this</span>.state.xIsNext,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>修改之后，我们就实现了 “X” 和 “O” 轮流落子的效果，试玩一下。</p>
<p>接下来修改 Board 组件 render 方法中的 “status” 的值，这样就可以显示下一步是哪个玩家的了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> status = <span class="string">&#x27;Next player is&#x27;</span> + (<span class="built_in">this</span>.xIsNext ? <span class="string">&quot;X&quot;</span> : <span class="string">&quot;O&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在你整个的代码应该是这样子的： 略！</p>
<h3 id="判断出胜者"><a href="#判断出胜者" class="headerlink" title="判断出胜者"></a>判断出胜者</h3><p>至此我们就可以看出下一步会轮到哪位玩家，与此同时，我们还要显示游戏的结果来判定游戏结束。拷贝如下 <code>calculateWinner</code> 函数并粘贴到文件底部：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculateWinner</span>(<span class="params">squares</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> lines = [</span><br><span class="line">    <span class="comment">// 三行</span></span><br><span class="line">    [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>],</span><br><span class="line">    [<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],</span><br><span class="line">    [<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>],</span><br><span class="line">    <span class="comment">// 三列</span></span><br><span class="line">    [<span class="number">0</span>,<span class="number">3</span>,<span class="number">6</span>],</span><br><span class="line">    [<span class="number">1</span>,<span class="number">4</span>,<span class="number">7</span>],</span><br><span class="line">    [<span class="number">2</span>,<span class="number">5</span>,<span class="number">8</span>],</span><br><span class="line">    <span class="comment">// 一个叉</span></span><br><span class="line">    [<span class="number">0</span>,<span class="number">4</span>,<span class="number">8</span>],</span><br><span class="line">    [<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>],</span><br><span class="line">    <span class="comment">// 只要用状态通过这个索引判断,是不是相等的,就能判断出胜利者</span></span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span> ; i&lt;lines.length;i++)&#123;</span><br><span class="line">    <span class="keyword">const</span> [a,b,c] = lines[i];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(squares[a] &amp;&amp; squares[a] === squares[b] &amp;&amp; squares[a]=== squares[c])&#123;</span><br><span class="line">      <span class="keyword">return</span> squares[a]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>传入长度为 9 的数组，此函数将判断出获胜者，并根据情况返回 “X”,”O”,或”null”。</p>
<!-- 本来没看懂,想了一下,妈的绝了 -->
<!-- 我怎么才能相通这些逻辑呢 -->
<!-- 还是只能通过模仿 -->
<!-- 唉 长路漫漫 -->

<p>接着,在 Board 组件中的 render 方法中调用,这个 calculateWinner(squares) 方法检测是否有玩家胜出。一旦有玩家获胜，就把获胜玩家的信息展示出来。</p>
<p>比如,”胜者: X” 或者 “胜者: O” 。现在，我们把 Board 的 render 函数中 status 的定义修改为如下代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> winner = calculateWinner(<span class="built_in">this</span>.state.squares)</span><br><span class="line"><span class="keyword">let</span> status;</span><br><span class="line"><span class="keyword">if</span> (winner)&#123;</span><br><span class="line">  status = <span class="string">&quot;Winner: &quot;</span> + winner</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  status = <span class="string">&quot;Next player is: &quot;</span> + (<span class="built_in">this</span>.state.xIsNext ? <span class="string">&quot;X&quot;</span> : <span class="string">&quot;O&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  <span class="comment">// 其他部分没有修改</span></span><br></pre></td></tr></table></figure>
<p>最后,修改 handleClick 事件,当有玩家胜出,或者某个 Square 已经填充时,该函数不做任何处理直接返回.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">handleClick</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> squares = <span class="built_in">this</span>.state.squares.clice()</span><br><span class="line">  <span class="keyword">if</span>(calculateWinner(squares) || squares[i])&#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 啊,我本来就想过,要是点击落子之后,再次点击的话就直接覆盖了,这个你要怎么处理,还有就是结束之后呢</span></span><br><span class="line">  <span class="comment">// 就是没想到,可以直接判断后,不执行更改状态的函数</span></span><br><span class="line">  <span class="comment">// 更想不到直接这么判断就可以,代码写的很简洁</span></span><br><span class="line">  <span class="comment">// 服气的</span></span><br><span class="line">  square[i] = <span class="built_in">this</span>.state.xIsNext? <span class="string">&quot;X&quot;</span>: <span class="string">&quot;O&quot;</span></span><br><span class="line">  <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">    suqares,</span><br><span class="line">    <span class="attr">xIsNext</span>: !<span class="built_in">this</span>.state.xIsNext</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>恭喜!现在你已经完成了井字棋!除此之外,你也已经掌握了 React 的基本常识.所以坚持到这一步的你才是真正的赢家呀!</p>
<h3 id="时间旅行"><a href="#时间旅行" class="headerlink" title="时间旅行"></a>时间旅行</h3><p>接下来是最后一个练习,我们将实现 “回到过去” 的功能,从而在游戏里跳回到历史步骤.</p>
<h4 id="保存历史记录"><a href="#保存历史记录" class="headerlink" title="保存历史记录"></a>保存历史记录</h4><p>如果我们直接修改了 square 数组,实现时间旅行就会变得很棘手了.</p>
<p>不过,我们可以使用 slice() 函数为每一步创建 squares 数组的副本,同时把这个数组当作不可变对像.这样我们就可以把所有 squares 数组的历史版本都保存下来了,然后可以在历史的步骤中随意跳转.</p>
<p>我们把历史的 squares 数组保存在另一个名为 history 的数组中.<br>history 数组保存了从第一步到最后一步的所有棋盘状态. history 数组的结构如下所示:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">history = [</span><br><span class="line">  <span class="comment">// 第一步之前</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">squares</span>:[</span><br><span class="line">      <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>,</span><br><span class="line">      <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>,</span><br><span class="line">      <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 第一步之后</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">squares</span>:[</span><br><span class="line">      <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>,</span><br><span class="line">      <span class="literal">null</span>, <span class="string">&#x27;X&#x27;</span>, <span class="literal">null</span>,</span><br><span class="line">      <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 第二步之后</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">squares</span>:[</span><br><span class="line">      <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>,</span><br><span class="line">      <span class="literal">null</span>, <span class="string">&#x27;X&#x27;</span>, <span class="literal">null</span>,</span><br><span class="line">      <span class="literal">null</span>, <span class="literal">null</span>, <span class="string">&#x27;O&#x27;</span>,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>现在,我们需要确定应该在哪一个组件中保存 history 这个 state.</p>
<h4 id="再次提升状态"><a href="#再次提升状态" class="headerlink" title="再次提升状态"></a>再次提升状态</h4><p>我们希望顶层 Game 组件展示出一个历史步骤的列表.这个功能需要访问 history 的数据,因此我们把 history 这个 state 放在顶层的 Game 组件中.</p>
<p>我们把 history state 放在了 Game 组件中,这样就可以从它的子组件 Board 里面删掉 square 中的 state . 正如我们把 Square 组件的抓过你太提升到 Board 组件一样,现在我们来吧 state 从 Board 组件提升到顶层的 Game 组件里.这样,Game 组件就拥有了对 Board 组件数据的完全控制权,除此之外,还可以让 Game 组件控制 Board 组件,并根据 history 渲染历史步骤.</p>
<p>首先,我们在 Game 组件中的构造函数中初始化 state:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">super</span>(props)</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      <span class="attr">history</span>:[&#123;</span><br><span class="line">        <span class="attr">suqares</span>:<span class="built_in">Array</span>(<span class="number">9</span>).fill(<span class="literal">null</span>)</span><br><span class="line">      &#125;],</span><br><span class="line">      <span class="attr">xIsNext</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>(</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game_board&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Board</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game_info&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;/* status */&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">ol</span>&gt;</span>&#123;/* TODO */&#125;<span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下一步,我们让 Board 组件从 Game 组件中接收 squares 和 onClick 这两个 props . 因为当前在 Board 组件中已经有一个对 square 点击事件的监听函数,这样监听函数就知道具体哪一个 Square 被点击了.以下是修改 Board 组建的几个必要步骤:</p>
<ul>
<li>删除 Board 组件中的<code>constructor</code>构造函数.</li>
<li>把 Board 组件中的 renderSquare 中的 <code>this.state.squares[i]</code> 替换为 <code>this.props.squares[i]</code>.</li>
<li>把 Board 组件的 renderSquare 中的 <code>this.handleClick(i)</code> 替换为 <code>this.props.onClick(i)</code></li>
</ul>
<p>修改后的 Board 组件如下所示:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="title">handleClick</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> squares = <span class="built_in">this</span>.state.squares.slice();</span><br><span class="line">    <span class="keyword">if</span>(calculateWinner(squares) || squares[i])&#123;</span><br><span class="line">      <span class="attr">return</span>:</span><br><span class="line">    &#125;</span><br><span class="line">    squares[i]=<span class="built_in">this</span>.state.xIsNext ? <span class="string">&quot;X&quot;</span> : <span class="string">&quot;O&quot;</span></span><br><span class="line">    <span class="built_in">this</span>.setstate(&#123;</span><br><span class="line">      squares,</span><br><span class="line">      <span class="attr">xIsNext</span>:!<span class="built_in">this</span>.state.xIsNext</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">renderSquares</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">Square</span> </span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">value</span>=<span class="string">&#123;this.props.value&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>this.props.onClick(i)&#125;</span></span><br><span class="line"><span class="xml">      /&gt;</span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 通过状态派生出的内容可以定义在 render 函数的顶部</span></span><br><span class="line">    <span class="keyword">const</span> winner = calculateWinner(<span class="built_in">this</span>.state.squares)</span><br><span class="line">    <span class="keyword">let</span> status;</span><br><span class="line">    <span class="keyword">if</span>(winner)&#123;</span><br><span class="line">      status = <span class="string">&quot;winner is &quot;</span> + winner</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      status = <span class="string">&quot;next player is &quot;</span> + (<span class="built_in">this</span>.state.xIsNext ? <span class="string">&quot;X&quot;</span> : <span class="string">&quot;O&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;status&quot;</span>&gt;</span>&#123;status&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;board-row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          &#123;this.renderSquare(0)&#125;</span></span><br><span class="line"><span class="xml">          &#123;this.renderSquare(1)&#125;</span></span><br><span class="line"><span class="xml">          &#123;this.renderSquare(2)&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;board-row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          &#123;this.renderSquare(3)&#125;</span></span><br><span class="line"><span class="xml">          &#123;this.renderSquare(4)&#125;</span></span><br><span class="line"><span class="xml">          &#123;this.renderSquare(5)&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;board-row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          &#123;this.renderSquare(6)&#125;</span></span><br><span class="line"><span class="xml">          &#123;this.renderSquare(7)&#125;</span></span><br><span class="line"><span class="xml">          &#123;this.renderSquare(8)&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着,更新 Game 组件的 render 函数,使用最新一次历史记录来确定展示游戏的状态:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> history = <span class="built_in">this</span>.state.history;</span><br><span class="line">  <span class="keyword">const</span> current = <span class="built_in">this</span>.state.history[history.length-<span class="number">1</span>]</span><br><span class="line">  <span class="keyword">const</span> winner = calculateWinner(current.squares)</span><br><span class="line">  <span class="keyword">let</span> status;</span><br><span class="line">  <span class="keyword">if</span>(winner)&#123;</span><br><span class="line">    status = <span class="string">&quot;winner &quot;</span> + winner</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    status = <span class="string">&quot;next player :&quot;</span> = (<span class="built_in">this</span>.state.xIsNext ? <span class="string">&quot;X&quot;</span>:<span class="string">&quot;O&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game-board&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Board</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">          <span class="attr">squares</span>=<span class="string">&#123;current.squares&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">          <span class="attr">onClick</span>=<span class="string">&#123;(i)</span> =&gt;</span> this.handleClick(i)&#125;</span></span><br><span class="line"><span class="xml">        /&gt;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game-info&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;status&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">ol</span>&gt;</span>&#123;/* TODO */&#125;<span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于 Game 组件渲染了游戏的抓过你太,因此我们可以将 Board 组件 render 方法中对应的代码移除.修改之后, Board 组件的render 函数如下所示:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;board-row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;this.renderSquare(0)&#125;</span></span><br><span class="line"><span class="xml">        &#123;this.renderSquare(1)&#125;</span></span><br><span class="line"><span class="xml">        &#123;this.renderSquare(2)&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;board-row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;this.renderSquare(3)&#125;</span></span><br><span class="line"><span class="xml">        &#123;this.renderSquare(4)&#125;</span></span><br><span class="line"><span class="xml">        &#123;this.renderSquare(5)&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;board-row&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;this.renderSquare(6)&#125;</span></span><br><span class="line"><span class="xml">        &#123;this.renderSquare(7)&#125;</span></span><br><span class="line"><span class="xml">        &#123;this.renderSquare(8)&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后,我们需要把 Board 组件的 handleClick 方法移动 Game 组件中.同时,我们也需要修改一下 handleClick 方法,因为这两个组件的 state 在结构上有所不同. 在 Game 组件中的 handleClick 方法中,我们需要把新的历史记录拼接到 history 上.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">handleClick</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> history = <span class="built_in">this</span>.state.history;</span><br><span class="line">  <span class="keyword">const</span> current = history[history.length - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">const</span> squares = current.squares.slice();</span><br><span class="line">  <span class="keyword">if</span> (calculateWinner(squares) || squares[i]) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  squares[i] = <span class="built_in">this</span>.state.xIsNext ? <span class="string">&#x27;X&#x27;</span> : <span class="string">&#x27;O&#x27;</span>;</span><br><span class="line">  <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">    <span class="attr">history</span>: history.concat([&#123;</span><br><span class="line">      <span class="attr">squares</span>: squares,</span><br><span class="line">    &#125;]),</span><br><span class="line">    <span class="attr">xIsNext</span>: !<span class="built_in">this</span>.state.xIsNext,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><code>注意: concat() 方法可能与你熟悉的 push() 方法不太一样,它并不会改变原数组,所以我们推荐使用 concat()</code></strong></p>
<p>到目前为止,Board 组件只需要 renderSquare 和 render 这两个方法.而游戏的状态和 handleClick 方法则会放在 Game 组件当中.</p>
<p>由于我们已经记录了井字棋的历史记录,因此我们呢可以把这些记录以历史步骤列表的形式展示给玩家.</p>
<p>在前文中提到的 React 元素,被视为 JavaScript 一等公民中的对象(first-class JavaScript objects),因此我们可以把 React 元素在应用程序中当作参数来传递.在 React 中,我们还可以使用 React 元素的数组来渲染多个元素.</p>
<p>在 JavaScript 中,数组拥有 map() 方法,该方法通常用于把某数组映射为另一个数组,例如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="keyword">const</span> doubled = numbers.map(<span class="function"><span class="params">x</span>=&gt;</span>x*<span class="number">2</span>) <span class="comment">// [2,4,6]</span></span><br></pre></td></tr></table></figure>
<p>我们可以通过使用 map 方法,把历史步骤映射为代表按钮的 React 元素,然后可以展示出一个按钮的列表,点击这些按钮,可以”跳转”到对应的历史步骤.</p>
<p>现在,我们在 Game 组件的 render 方法中调用 history 的 map 方法:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> history = <span class="built_in">this</span>.state.history;</span><br><span class="line">  <span class="keyword">const</span> current = history[history.length - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">const</span> winner = calculateWinner(current.squares);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> moves = history.map(<span class="function">(<span class="params">step, move</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> desc = move ?</span><br><span class="line">      <span class="string">&#x27;Go to move #&#x27;</span> + move :</span><br><span class="line">      <span class="string">&#x27;Go to game start&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> this.jumpTo(move)&#125;&gt;&#123;desc&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> status;</span><br><span class="line">  <span class="keyword">if</span> (winner) &#123;</span><br><span class="line">    status = <span class="string">&#x27;Winner: &#x27;</span> + winner;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    status = <span class="string">&#x27;Next player: &#x27;</span> + (<span class="built_in">this</span>.state.xIsNext ? <span class="string">&#x27;X&#x27;</span> : <span class="string">&#x27;O&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game-board&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Board</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">          <span class="attr">squares</span>=<span class="string">&#123;current.squares&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">          <span class="attr">onClick</span>=<span class="string">&#123;(i)</span> =&gt;</span> this.handleClick(i)&#125;</span></span><br><span class="line"><span class="xml">        /&gt;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;game-info&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;status&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">ol</span>&gt;</span>&#123;moves&#125;<span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于井字棋历史记录的每一步,我们都创建出了一个包含按钮 <code>&lt;button&gt;</code> 元素的 <code>&lt;lI&gt;</code> 的列表.这些按钮拥有一个 <code>onClick</code> 事件处理函数,在这个函数里调用了 <code>this.jumpTo()</code> 方法.但是我们还没有实现 <code>jumpTo()</code> 方法,到目前为止,我们可以看到一个游戏历史步骤的列表,以及开发者工具控制台的警告信息,警告信息如下:<br><strong><code>Warning:Each child in an array or iterator should have a unique &quot;key&quot; prop. Check the render method of &quot;Game&quot;</code></strong></p>
<p>我们来看一下上面的警告信息是什么意思.</p>
<h4 id="选择一个-key"><a href="#选择一个-key" class="headerlink" title="选择一个 key"></a>选择一个 key</h4><p>当我们要渲染一个列表的时候, React 会存储这个列表每一项的相关信息.当我们要更新这个列表是,React 需要确定哪些项发生了改变.我们有可能增加、删除、重新排序或者更新列表项。</p>
<p>想象一下把下面的代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>Alexa: 7 tasks left<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>Ben: 5 tasks left<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>转换成下面的代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>Ben: 9 tasks left<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>Claudia: 8 tasks left<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>Alexa: 5 tasks left<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>除了数字发生了改变之外,阅读这段代码的人会认为我们把 Alexa 和 Ben 的顺序交换了位置,然后把 Claudia 插入到 Alexa 和 Ben 之间.然而,React 是电脑程序,它并不知道我们想要什么.因为 React 无法得知我们人类的意图,所以我们要给每一个列表项一个确定的 <em>key</em> 属性,它可以用来区分不同的列表项和他们的同级兄弟列表项.你可以使用字符串,比如 alexa,ben,Claudia. 如果我们使用从数据库里获取的数据,那么 Alexa、Ben 和 Claudia 的数据库 ID 就可以作为 key 来使用。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;li key=&#123;user.id&#125;&gt;&#123;user.name&#125;:&#123;user.taskCount&#125; tasks left&lt;/li&gt;</span><br></pre></td></tr></table></figure>
<p>每当一个列表重新渲染时,React 会根据每一项列表元素的 key 来检索上一次渲染时与每个 key 所匹配的列表项.如果 React 发现当前的列表有一个之前不存在的 key ,那么就会创建出一个新的组件. 如果 React 发现和之前对比上了一个key,那么就会销毁之前对应的组件.如果一个组建的 key 发生了变化,这个组件就会被销毁,然后使用新的 state 重新创建一份.</p>
<p>key 是 React 中一个特殊的保留属性(还有一个是 <code>ref</code> ,拥有更高级的特性).当 React 元素被创建出来的时候,React 会提取出<code>key</code>属性,然后把 key 直接存储在返回的元素上.虽然 key 看起来好像是 props 中的一个,但是你不能通过<code>this.props.key</code>来获取 key .React 会通过 key 来自动判断哪些组件需要更新.组件是不能访问到它的 key 的.</p>
<p><strong>我们强烈推荐,每次只要你构建动态列表时,都要指定一个合适的 key</strong>.如果你没有找到一个合适的 key,那么你就需要考虑重新整理你的数据结构了,这样才能有合适的key.</p>
<p>如果你没有指定任何 key ,React 会发出警告,并且会把数组的索引当作默认的 key ,但是如果想要对列表进行重新排序、新增、删除操作时，把数组索引作为 key 是有问题的。显式地使用 <code>key=&#123;i&#125;</code> 来指定 key 确实会消除警告,但是仍然和数组索引存在同样的问题,所以大多数情况下最好不要这么做.</p>
<p>组建的 key 值并不需要在全局都保证唯一,只需要在当前的同一级元素之前保证唯一即可.</p>
<h4 id="实现时间旅行"><a href="#实现时间旅行" class="headerlink" title="实现时间旅行"></a>实现时间旅行</h4><p>在井字棋的历史记录中,每一个历史步骤都有一个与之对应的唯一 ID:<br>这个 ID 就是每一步棋的序号.因为历史步骤不需要重新排序、新增、删除，所以使用步骤的索引作为<code>key</code>是安全的。</p>
<p>在 Game 组件的 render 方法中，我们可以这样添加 key ，<code>&lt;li key= &#123;move&#125;&gt;</code>,这样关于 key 的警告就会消失了</p>
<p>因为<code>jumpTo</code>还未定义,所以你点击列表项会出现报错.实现 jumpTo 之前,我们先向 Game 组件的 state 中添加 stepNumber,这个值代表我们当前正在查看哪一项历史记录.</p>
<p>首先,我们在 Game 的构造函数 constructor 中向初始 state 中添加 <code>stepNumber: 0</code>:</p>
<!-- 草!我想到了,通过改这个索引九宫格渲染当前历史state对应的数据,点击列表项更改这个索引就行了-->
<!-- 额…… 我不是想到了，我是看明白了 -->

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      <span class="attr">history</span>: [&#123;</span><br><span class="line">        <span class="attr">squares</span>: <span class="built_in">Array</span>(<span class="number">9</span>).fill(<span class="literal">null</span>),</span><br><span class="line">      &#125;],</span><br><span class="line">      <span class="attr">stepNumber</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">xIsNext</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>然后,我们在 Game 组件中定义 jumpTo 方法已更新状态 stepNumber .除此之外,当状态 stepNumber 是偶数时,我们还要把 xIsNext 设为 true:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">handleClick</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 这个方法无更改</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">jumpTo</span>(<span class="params">step</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">    <span class="attr">stepNumber</span>: step,</span><br><span class="line">    <span class="attr">xIsNext</span>: (step % <span class="number">2</span>) === <span class="number">0</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 这个方法无更改</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来,我们还要修改 Game 组件的 handleClick 方法,当你点击方格的时候触发该方法.</p>
<p>新添加的 stepNumber state 用于给用户展示当前的步骤.每当我们落下一颗新棋子的时候,我们需要调用 this.setState 并传入参数 <code>stepNumber:history.length</code>,以更新 stepNumber.这就保证了每走一步 stepNumber 都会跟着改变.</p>
<p>我们还把读取 this.state.history 换成了读取 <code>this.state.history.slice(0,this.state.stepNumber + 1)</code>的值.如果我们”回到过去”,然后再走一步新棋子,原来的”未来”历史记录就不正确了,这个替换可以保证我们把这些”未来”的不正确的历史记录丢弃掉.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">handleClick</span>(<span class="params">i</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> history = <span class="built_in">this</span>.state.history.slice(<span class="number">0</span>, <span class="built_in">this</span>.state.stepNumber + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">const</span> current = history[history.length - <span class="number">1</span>];</span><br><span class="line">  <span class="keyword">const</span> squares = current.squares.slice();</span><br><span class="line">  <span class="keyword">if</span> (calculateWinner(squares) || squares[i]) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  squares[i] = <span class="built_in">this</span>.state.xIsNext ? <span class="string">&#x27;X&#x27;</span> : <span class="string">&#x27;O&#x27;</span>;</span><br><span class="line">  <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">    <span class="attr">history</span>: history.concat([&#123;</span><br><span class="line">      <span class="attr">squares</span>: squares</span><br><span class="line">    &#125;]),</span><br><span class="line">    <span class="attr">stepNumber</span>: history.length,</span><br><span class="line">    <span class="attr">xIsNext</span>: !<span class="built_in">this</span>.state.xIsNext,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后,修改 Game 组件中的 render 方法,将代码从始终根据最后一次移动渲染,修改为根据当前 stepNumber 渲染.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> history = <span class="built_in">this</span>.state.history;</span><br><span class="line">   <span class="keyword">const</span> current = history[<span class="built_in">this</span>.state.stepNumber];</span><br><span class="line">   <span class="keyword">const</span> winner = calculateWinner(current.squares);</span><br><span class="line"></span><br><span class="line">   <span class="comment">// 其他部分没有改变</span></span><br></pre></td></tr></table></figure>
<p>如果我们点击游戏历史记录的任意一步,井字棋的棋盘就会立即更新为刚走那一步棋时候的样子.</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>恭喜你! 你已经完成了一个拥有以下功能的井字棋啦:</p>
<ul>
<li>tic-toc-toe(三连棋)游戏的所有功能</li>
<li>能够判定玩家何时获胜</li>
<li>能够记录游戏进程</li>
<li>允许玩家查看游戏的历史记录,也可以查看任意一个历史版本的游戏棋盘状态</li>
</ul>
<p>干得不错!我们希望你至此已经基本掌握了 React 的使用.</p>
<p>在这里可以查看游戏的最终代码:<a target="_blank" rel="noopener" href="https://codepen.io/gaearon/pen/gWWZgR?editors=0010">最终结果</a></p>
<p>如果你还有充裕的时间,或者想练习一下刚刚学会的 React 新技能,这里有一些可以改进游戏的想法供你参考,这些功能的实现顺序的难度是递增的:</p>
<ol>
<li>在游戏历史纪录列表显示每一步棋的坐标,格式为(列号,行号)</li>
<li>在历史纪录列表中加粗显示当前选择的项目.</li>
<li>使用两个循环来渲染出棋盘的格子,而不是在代码里写死(hardcode)</li>
<li>添加一个可以升序或降序显示历史记录的按钮</li>
<li>每当有人获胜时,高亮显示连成一线的 3 颗棋子</li>
<li>当无人获胜时,显示一个平局的消息</li>
</ol>
<p>通过这篇教程,我们接触了 React 中的一些概念,比如 React 元素、React 组件、props，还有 state。更多关于这些概念的细节的解释，参考<a target="_blank" rel="noopener" href="https://react.docschina.org/docs/hello-world.html">文档的其他部分</a>。了解更多关于组件定义的内容，参考<a target="_blank" rel="noopener" href="https://react.docschina.org/docs/react-component.html">React.Component API reference</a>。</p>
<div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none; padding-left: 0;"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">1.</span><span style="display: inline-block; vertical-align: top;">不考虑</span><a href="#fnref:1" rev="footnote"> ↩</a></li></ol></div></div>
    <p class="suffix-end">__END__</p>
    <!-- <div class="suffix-box">
            <div class="suffix-box-left">
                <img src="https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/image/sidebar/avatar.jpg" alt="Just For Fun">
            </div>
            <div class="suffix-box-right">
                <span class="suffix-box-title">文章作者</span>：Just For Fun
                <br>
                <span class="suffix-box-title">文章出处</span>：<a href="/2021/07/02/REACT-%E4%BA%95%E5%AD%97%E6%A3%8B/" target="_blank">REACT 井字棋</a>
                <br>
                <span class="suffix-box-title">作者签名</span>：简单地活着, 肆意又精彩.
                <br>
                <span class="suffix-box-title">关于主题</span>：<a href="https://github.com/first19326/Hexo-LiveForCode" target="_blank">Hexo - Live For Code</a>
                <br>
                <span class="suffix-box-title">版权声明</span>：文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" title="BY-NC-SA" target="_blank">BY-NC-SA</a> 许可协议，转载请注明出处
                <br>
            </div>
            <div style="clear: both;"></div>
        </div> -->
  </div>
  <div class="article-footer">
     
    <div class="article-prev-next">
      
      <span>
        <a href="/2021/07/04/%E4%B8%8D%E7%9F%A5%E9%81%93%E5%93%AA%E6%94%B9%E4%BA%86/" class="prev-prefix">« </a> 上一篇：
        <a
          href="/2021/07/04/%E4%B8%8D%E7%9F%A5%E9%81%93%E5%93%AA%E6%94%B9%E4%BA%86/"
          title="发布于 2021-07-04 12:06"
          >state 不知道哪改了</a
        >
      </span>
      <br />
       
      <span>
        下一篇：
        <a
          href="/2021/07/02/%E5%8F%88%E6%90%9E%E4%BA%86%E4%B8%80%E6%8A%8A%E9%94%AE%E7%9B%98/"
          title="发布于 2021-07-02 10:42"
          >又搞了一把键盘</a
        >
        <a href="/2021/07/02/%E5%8F%88%E6%90%9E%E4%BA%86%E4%B8%80%E6%8A%8A%E9%94%AE%E7%9B%98/" class="next-prefix">» </a>
      </span>
      
    </div>
  </div>
  <!-- 
    <div class="article-comments">
        <div class="comments-title">
            评论列表
        </div>
        <div class="comments-content">
        </div>
    </div>
 -->
  <!-- html 注释对 ejs 依旧有效啊 -->
  <!-- 只是标签颜色还是看不太出来 -->
</div>

    </div>
</div>
    <div id="footer"></div>
    <div id="sidebar">
    <div class="menu-wrap" style="display:none;">
        <nav class="menu">
            <div class="menu-introduce"> 
                <div class="introduce-avatar"></div> 
                <div class="introduce-info"> 
                    <div class="introduce-user"><span></span></div>        
                </div> 
            </div> 
            <div class="menu-list">
                <ul></ul> 
            </div> 
            <div class="menu-link"></div> 
        </nav>
        <button class="menu-button-close"></button>
        <div class="morph-shape" id="morph-shape" data-morph-open="M-7.312,0H15c0,0,66,113.339,66,399.5C81,664.006,15,800,15,800H-7.312V0z;M-7.312,0H100c0,0,0,113.839,0,400c0,264.506,0,400,0,400H-7.312V0z">
            <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 100 800" preserveAspectRatio="none">
                <path d="M-7.312,0H0c0,0,0,113.839,0,400c0,264.506,0,400,0,400h-7.312V0z"/>
            </svg>
        </div>
    </div>
    <button class="menu-button-open">MENU</button>
    <div class="menu-cover"></div>
</div>
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/css/search.css">
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/js/iscroll.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/js/instantsearch.min.js"></script>
<div class="search-window">
    <div class="search-content">
        <div class="search-content-icon">
            <i class="iconfont icon-search"></i>
        </div>
        <div id="search-input" class="search-input"></div>
    </div>

    <div class="search-scroll">
        <div class="search-result">
            <div id="search-stats" class="search-stats"></div>
            <div id="search-hits"></div>
            <div id="search-pagination" class="search-pagination"></div>
        </div>
    </div>

    <span class="search-close-icon">
        <i class="iconfont icon-close"></i>
    </span>
</div>
    <div id="tools">
    <div class="progressbar-top"></div>

    
        <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/css/APlayer.css">
        <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/js/APlayer.min.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/js/Meting.min.js"></script>
        <meting-js id="3778678" lrcshow="false" server="netease" type="playlist" fixed="true" autoplay="false" loop="all" order="random" preload="auto" volume="0.67" mutex="true"></meting-js>
    
    
    <div class="wrap-right"></div>
    <div class="loading"></div>
</div>
    <script>
    window.config = {
        GitHubUserName     : 'first19326',
        GitHubRepositories : 'Hexo-LiveForCode',

        BlogUser      : 'Just For Fun',
        BlogAvatar    : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/image/sidebar/avatar.jpg',
        BlogStartDate : '2020-01-01',

        WebsiteTitleBlur         : '(◍´꒳`◍) Hi, Live For Code',
        WebsiteTitleBlurTimeOut  : 500,
        WebsiteTitleFocus        : '(*´∇｀*) 欢迎回来!',
        WebsiteTitleFocusTimeOut : 1000,
        WebsiteFavicon           : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/image/website/logo.png',

        ProgressBar: {
            id       : 'topProgressBar',
            color    : '#77B6FF',
            height   : '4px',
            duration : 0.2
        },

        Loading: {
            rebound: {
                tension  : 16,
                friction : 5
            },
            spinner: {
                id     : 'spinner',
                radius : 90,
                sides  : 3,
                depth  : 4,
                colors : {
                    background : '#F0F0F0',
                    stroke     : '#272633',
                    base       : '',
                    child      : '#272633'
                },
                alwaysForward : true,
                restAt        : 0.5,
                renderBase    : false
            }
        },

        HomeHeaderAnimationRendered : true,
        HomeHeaderAnimation         : {
            radius      : 15,
            density     : 0.2,
            color       : 'rgba(255, 255, 255, .2)',
            clearOffset : 0.3
        },

        ArticleHeaderAnimationRendered : false,
        ArticleHeaderAnimation         : {
            triW                  : 14,
            triH                  : 20,
            neighbours            : [
                
                    'side',
                
                    'top',
                
                    'bottom',
                
            ],
            speedTrailAppear      : 0.1,
            speedTrailDisappear   : 0.1,
            speedTriOpen          : 1,
            trailMaxLength        : 30,
            trailIntervalCreation : 100,
            delayBeforeDisappear  : 2,
            colors                : [
                
                    '#96EDA6',
                
                    '#5BC6A9',
                
                    '#38668C',
                
                    '#374D84',
                
                    '#BED5CB',
                
                    '#62ADC6',
                
                    '#8EE5DE',
                
                    '#304E7B',
                
            ]
        },

        BackAnimationRendered          : true,
        IEBrowserBackAnimationRendered : false,
        BackAnimation                  : {
            colorSaturation  : '60%',
            colorBrightness  : '50%',
            colorAlpha       : 0.5,
            colorCycleSpeed  : 5,
            verticalPosition : 'random',
            horizontalSpeed  : 200,
            ribbonCount      : 3,
            strokeSize       : 0,
            parallaxAmount   : -0.2,
            animateSections  : true
        },

        HomeHeaderImage : [
            
                'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/image/header/home.jpg',
            
        ],
        HomeBannerText  : '他们说你有妄想，说你眼中闪着你生命的光，他们说你所有的梦想都会成真',

        ArticleHeaderImage : [
            
                'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/image/header/article.jpg',
            
                './bing.jpg',
            
        ],

        OtherBannerText : '',

        MenuList : [
            
                {
                    name   : '首页',
                    href   : '/',    
                    target : '',
                    class  : ''
                },
            
                {
                    name   : '标签',
                    href   : '/tag',    
                    target : '',
                    class  : ''
                },
            
                {
                    name   : '分类',
                    href   : '/category',    
                    target : '',
                    class  : ''
                },
            
                {
                    name   : '归档',
                    href   : '/archive',    
                    target : '',
                    class  : ''
                },
            
                {
                    name   : '赞赏',
                    href   : '/donate',    
                    target : '',
                    class  : ''
                },
            
                {
                    name   : '关于',
                    href   : '/about',    
                    target : '',
                    class  : ''
                },
            
                {
                    name   : '订阅',
                    href   : '/atom.xml',    
                    target : '_blank',
                    class  : ''
                },
            
                {
                    name   : '搜索',
                    href   : '',    
                    target : '',
                    class  : 'search'
                },
            
                {
                    name   : '留言板',
                    href   : '/comment',    
                    target : '',
                    class  : ''
                },
            
                {
                    name   : '友情链接',
                    href   : '/friend',    
                    target : '',
                    class  : ''
                },
            
        ],
        MenuLink : [
            
                
                    {
                        icon : 'icon-weibo', 
                        url  : ''
                    },
                
                    {
                        icon : 'icon-wechat', 
                        url  : ''
                    },
                
                    {
                        icon : 'icon-qq', 
                        url  : ''
                    },
                
                    {
                        icon : 'icon-github', 
                        url  : 'https://github.com/first19326'
                    },
                
            
        ],

        FooterStyle : 2,
        BottomText  : {
            icon    : 'like-fill',
            left    : '此朝花落忽抬眼',
            right   : '吾已待君千百年'
        },
        ThemeInfo   : true,

        ConsoleList : [
            
                
                    [
                        
                            
                                'Based on cnblogs theme SimpleMemory.',
                            
                                '',
                            
                        
                    ],
                
                    [
                        
                            
                                'SimpleMemory Author:',
                            
                                'BNDong',
                            
                        
                    ],
                
                    [
                        
                            
                                'Theme:',
                            
                                'LiveForCode',
                            
                        
                    ],
                
            
        ],

        FontIconExtend : '',

        Donate : {
            paypal  : '',
            bitcoin : '',
            alipay  : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/image/donate/alipay.png',
            wechat  : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/image/donate/wechat.png'
        },

        Code : {
            style : 'normal'
        },  

        Search : {
            applicationID : '010C3EANT8',
            apiKey        : 'c7abab9f11b79102b9aff7fe6d41447d',
            indexName     : 'Notes',
            hits          : {
                page : 10
            },
            labels        : {
                placeholder : '搜索',
                empty       : '未发现与 「${query}」 相关的内容',
                stats       : '${hits} 条相关条目，使用了 ${time} 毫秒',
            }
        }, 

        Valine : {
            switch         : true,
            el             : '.comments-content',
            appId          : 'srhKtvWPQTWYKh3qX8G8M7v0-gzGzoHsz',
            appKey         : '8uVSP1q6UlALVC5igYfIfv2h',
            placeholder    : '你是我一生只会遇见一次的惊喜...',
            avatar         : 'mm',
            meta           : 'nick,mail,link',
            requiredFields : 'nick,mail',
            pageSize       : 5,
            lang           : 'zh-cn',
            visitor        : true,
            enableQQ       : true
        },

        Tocbot : {
            switch                : true,
            tocSelector           : '.toc',
            contentSelector       : '.article-body',
            headingSelector       : 'h1, h2, h3, h4, h5',
            headingsOffset        : 0,
            scrollSmooth          : true,
            scrollSmoothOffset    : -5,
            positionFixedSelector : '.toc',
            positionFixedClass    : 'toc-fixed',
            fixedSidebarOffset    : '',
        },

        Require : {
            baseUrl     : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/js/',
            waitSeconds : 100
        },

        Music : {
            type : 'Meting'
        },
        APlayer : {
            container : '.aplayer',
            fixed     : true,
            autoplay  : false,
            loop      : 'all',
            order     : 'random',
            preload   : 'auto',
            volume    : 0.67,
            mutex     : true,
            lrcType   : 3,
            audio     : [
                
                    {
                        name   : 'aLIEz',
                        artist : 'mizuki（瑞葵）',
                        cover  : '/music/cover/aLIEz.jpg',
                        url    : '/music/song/aLIEz.mp3',
                        lrc    : '/music/lrc/aLIEz.lrc'
                    },
                
                    {
                        name   : 'Endless Tears',
                        artist : 'CLIFF EDGE',
                        cover  : '/music/cover/Endless Tears.jpg',
                        url    : '/music/song/Endless Tears.mp3',
                        lrc    : '/music/lrc/Endless Tears.lrc'
                    },
                
                    {
                        name   : 'Miracle',
                        artist : 'Cascada',
                        cover  : '/music/cover/Miracle.jpg',
                        url    : '/music/song/Miracle.mp3',
                        lrc    : '/music/lrc/Miracle.lrc'
                    },
                
                    {
                        name   : 'Roll The Dice',
                        artist : '高珊',
                        cover  : '/music/cover/Roll The Dice.jpg',
                        url    : '/music/song/Roll The Dice.mp3',
                        lrc    : '/music/lrc/Roll The Dice.lrc'
                    },
                
                    {
                        name   : 'See You Again',
                        artist : 'Charlie Puth, Wiz Khalifa',
                        cover  : '/music/cover/See You Again.jpg',
                        url    : '/music/song/See You Again.mp3',
                        lrc    : '/music/lrc/See You Again.lrc'
                    },
                
                    {
                        name   : 'Traveling Light',
                        artist : 'Joel Hanson, Sara Groves',
                        cover  : '/music/cover/Traveling Light.jpg',
                        url    : '/music/song/Traveling Light.mp3',
                        lrc    : '/music/lrc/Traveling Light.lrc'
                    },
                
                    {
                        name   : '痴心绝对',
                        artist : '李圣杰',
                        cover  : '/music/cover/痴心绝对.jpg',
                        url    : '/music/song/痴心绝对.mp3',
                        lrc    : '/music/lrc/痴心绝对.lrc'
                    },
                
                    {
                        name   : '好想大声说爱你',
                        artist : 'BAAD（バード）',
                        cover  : '/music/cover/好想大声说爱你.jpg',
                        url    : '/music/song/好想大声说爱你.mp3',
                        lrc    : '/music/lrc/好想大声说爱你.lrc'
                    },
                
            ]
        },
        Meting : {
            id       : '3778678', 
            lrcshow  : false, 
            server   : 'netease', 
            type     : 'playlist', 
            fixed    : true, 
            autoplay : false, 
            loop     : 'all', 
            order    : 'random', 
            preload  : 'auto', 
            volume   : 0.67, 
            mutex    : true
        },

        LazyLoad : {
            default : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/image/website/lazyload.svg'
        },
  
        Style : {
            aplayer          : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/css/APlayer.css',
            archive          : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/css/archive.css',
            donate           : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/css/donate.css',
            fancybox         : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/css/jquery.fancybox.css',
            footer           : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/css/footer.css',
            iconfont         : 'https://at.alicdn.com/t/font_1546312_l3yohatebw.css',
            index            : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/css/index.css',
            menuBubble       : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/css/menu-bubble.css',
            page             : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/css/page.css',
            post             : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/css/post.css',
            search           : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/css/search.css',
            tocbot           : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/css/tocbot.css',
            normal           : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/css/normal.css',
            night            : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/css/night.css',
            clipboard        : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/css/clipboard.css'
        },

        Script: {
            aplayer          : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/js/APlayer.min.js',
            config           : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/js/require.config.js',
            index            : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/js/index.js',
            instantSearch    : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/js/instantsearch.min.js',
            jQuery           : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/js/jquery-3.4.1.min.js',
            loading          : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/js/loading.js',
            meting           : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/js/Meting.min.js',
            iscroll          : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/js/iscroll.js',
            require          : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/js/require.min.js'
        },

        Font: {
            LongCang   : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/font/LongCang.css',
            Monda      : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/font/Monda.css',
            NotoSansSC : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/font/NotoSansSC.css',
            Playball   : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/font/Playball.css',
            PTMono     : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/font/PTMono.css',
            RobotoSlab : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/font/RobotoSlab.css',
            Rosario    : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/font/Rosario.css',
            UbuntuMono : 'https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/font/UbuntuMono.css'
        },

        Suffix : {
            about : '简单地活着, 肆意又精彩.'
        },
            
        Theme : {
            url  : 'https://github.com/first19326/Hexo-LiveForCode',
            name : 'Hexo - Live For Code'
        }  
    };
</script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/first19326/cdn@master/static/js/index.js"></script>
</body>
</html>
